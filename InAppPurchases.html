<!-- HTML header for doxygen 1.13.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Keewano Unity SDK: In-App Purchases</title>
<link rel="icon" href="KeewanoLogo.svg" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
     <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
     <script type="text/javascript">
         DoxygenAwesomeDarkModeToggle.init()
     </script>
     <script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
     <script type="text/javascript">
          DoxygenAwesomeInteractiveToc.init()
     </script>
     <script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
     <script type="text/javascript">
       DoxygenAwesomeTabs.init()
     </script>
     <!-- Mermaid.js diagrams - custom styling for dark mode compatibility -->
     <style>
       /* Wrap diagram in white container for visibility in dark mode */
       .mermaid {
         background: #FFFFFF !important;
         padding: 20px;
         border-radius: 8px;
         margin: 20px 0;
       }
       /* Force all text to be black */
       .mermaid text {
         fill: #000000 !important;
       }
       /* Ensure lines are visible */
       .mermaid line,
       .mermaid path {
         stroke: #4285F4 !important;
       }
     </style>
     <script type="text/javascript" src="mermaid.min.js"></script>
     <script type="text/javascript">
       // Initialize Mermaid with simple default theme
       mermaid.initialize({
         startOnLoad: true,
         theme: 'default',
         securityLevel: 'loose',
         sequence: {
           useMaxWidth: true,
           mirrorActors: true
         }
       });
     </script>
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="KeewanoLogo.svg"/></td>
  <td id="projectalign">
   <div id="projectname">Keewano Unity SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('InAppPurchases.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">In-App Purchases </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1 class="doxsection"><a class="anchor" id="iap_overview"></a>
Overview</h1>
<p>In-app purchases (IAP) are real-money transactions where players purchase premium currency, items, or other content from app stores (Apple App Store, Google Play). The Keewano SDK provides dedicated methods to track both the monetary transaction and the virtual items granted from these purchases.</p>
<dl class="section note"><dt>Note</dt><dd><b>Best Practice: Server-Side Validation</b><br  />
For optimal fraud prevention and accurate analytics, we strongly recommend calling these IAP tracking methods only after your server validates the purchase receipt with Apple/Google. This ensures your revenue data reflects genuine transactions and helps the Keewano AI Agents provide more accurate insights.</dd></dl>
<h1 class="doxsection"><a class="anchor" id="iap_distinction"></a>
IAP vs Virtual Economy</h1>
<p>It's important to understand the distinction between two types of transactions in your game:</p>
<ul>
<li><b>In-App Purchases (IAP)</b>: Real money → Virtual currency/items (tracked with <span class="tt">ReportInAppPurchase</span> and <span class="tt">ReportInAppPurchaseItemsGranted</span>)</li>
<li><b>Virtual Economy</b>: Virtual items → Other virtual items (tracked with <span class="tt">ReportItemsExchange</span>)</li>
</ul>
<p>For example:</p><ul>
<li>Player buys "500 Crystals Pack" for $4.99 → <b>IAP</b></li>
<li>Player spends 100 Crystals to buy a sword → <b>Virtual Economy</b> (see <a class="el" href="ItemExchange.html">In-Game Balance</a>)</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="iap_methods"></a>
The Two IAP Methods</h1>
<p>The Keewano SDK provides two separate methods for tracking in-app purchases:</p>
<h2 class="doxsection"><a class="anchor" id="iap_purchase"></a>
1. ReportInAppPurchase - Track the Monetary Transaction</h2>
<p>Use <span class="tt"><a class="el" href="classKeewanoSDK.html#a865cb9d89581de571b8e52f113661cec" title="Reports an in-app purchase event.">KeewanoSDK.ReportInAppPurchase()</a></span> to log the real-money purchase event.</p>
<div class="fragment"><div class="line"><span class="comment">// After server validation</span></div>
<div class="line"><a class="code hl_class" href="classKeewanoSDK.html">KeewanoSDK</a>.<a class="code hl_function" href="classKeewanoSDK.html#a865cb9d89581de571b8e52f113661cec">ReportInAppPurchase</a>(productId, priceInUsdCents);</div>
<div class="ttc" id="aclassKeewanoSDK_html"><div class="ttname"><a href="classKeewanoSDK.html">KeewanoSDK</a></div><div class="ttdef"><b>Definition</b> KeewanoSDK.cs:18</div></div>
<div class="ttc" id="aclassKeewanoSDK_html_a865cb9d89581de571b8e52f113661cec"><div class="ttname"><a href="classKeewanoSDK.html#a865cb9d89581de571b8e52f113661cec">KeewanoSDK.ReportInAppPurchase</a></div><div class="ttdeci">static void ReportInAppPurchase(string productName, uint priceUsdCents)</div><div class="ttdoc">Reports an in-app purchase event.</div><div class="ttdef"><b>Definition</b> KeewanoSDK.cs:290</div></div>
</div><!-- fragment --><p><b>Parameters:</b></p><ul>
<li><span class="tt">productId</span> - The product identifier as defined in app stores (e.g., "com.mygame.crystals_500")</li>
<li><span class="tt">priceInUsdCents</span> - The price in US cents (e.g., $4.99 = 499)</li>
</ul>
<p><b>When to call:</b></p><ul>
<li>ONLY after your server validates the purchase with Apple/Google</li>
<li>ONCE per purchase (even if items are granted multiple times)</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="iap_items_granted"></a>
2. ReportInAppPurchaseItemsGranted - Track the Items Delivered</h2>
<p>Use <span class="tt"><a class="el" href="classKeewanoSDK.html#a3ead93092535e6bf2eed29f7688c9632" title="Reports items granted from an in-app purchase.">KeewanoSDK.ReportInAppPurchaseItemsGranted()</a></span> to log the virtual items or currencies granted to the player from the purchase.</p>
<div class="fragment"><div class="line"><span class="comment">// After server validation and successful grant</span></div>
<div class="line"><a class="code hl_namespace" href="namespaceKeewano.html">Keewano</a>.<a class="code hl_struct" href="structKeewano_1_1Item.html">Item</a>[] grantedItems = { <span class="keyword">new</span> <a class="code hl_namespace" href="namespaceKeewano.html">Keewano</a>.<a class="code hl_struct" href="structKeewano_1_1Item.html">Item</a>(<span class="stringliteral">&quot;Crystals&quot;</span>, 500) };</div>
<div class="line"><a class="code hl_class" href="classKeewanoSDK.html">KeewanoSDK</a>.<a class="code hl_function" href="classKeewanoSDK.html#a3ead93092535e6bf2eed29f7688c9632">ReportInAppPurchaseItemsGranted</a>(productId, grantedItems);</div>
<div class="ttc" id="aclassKeewanoSDK_html_a3ead93092535e6bf2eed29f7688c9632"><div class="ttname"><a href="classKeewanoSDK.html#a3ead93092535e6bf2eed29f7688c9632">KeewanoSDK.ReportInAppPurchaseItemsGranted</a></div><div class="ttdeci">static void ReportInAppPurchaseItemsGranted(string productName, Item[] items)</div><div class="ttdoc">Reports items granted from an in-app purchase.</div><div class="ttdef"><b>Definition</b> KeewanoSDK.cs:310</div></div>
<div class="ttc" id="anamespaceKeewano_html"><div class="ttname"><a href="namespaceKeewano.html">Keewano</a></div><div class="ttdef"><b>Definition</b> KBatch.cs:6</div></div>
<div class="ttc" id="astructKeewano_1_1Item_html"><div class="ttname"><a href="structKeewano_1_1Item.html">Keewano.Item</a></div><div class="ttdoc">Represents a game item with a unique identifier and a quantity.</div><div class="ttdef"><b>Definition</b> KeewanoItems.cs:11</div></div>
</div><!-- fragment --><p><b>Parameters:</b></p><ul>
<li><span class="tt">productId</span> - The same product identifier used in <span class="tt">ReportInAppPurchase</span></li>
<li><span class="tt">items</span> - Array of items granted (can also use <span class="tt">ReadOnlySpan&lt;Item&gt;</span> for zero-copy performance)</li>
</ul>
<p><b>When to call:</b></p><ul>
<li>ONLY after items are successfully granted to the player's account</li>
<li>Every time items are granted (can be multiple times for monthly/daily packages)</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="iap_why_separated"></a>
Why Are These Two Methods Separated?</h1>
<p>These methods are separated because <b>the purchase event and item grant event may happen at different times</b>:</p>
<h2 class="doxsection"><a class="anchor" id="iap_separation_reasons"></a>
Common Cases for Separation</h2>
<ol type="1">
<li><b>Asynchronous Server Validation</b>: Purchase completes → server validates → items granted later</li>
<li><b>Monthly Packages</b>: Player purchases once, but receives items daily/weekly over a month</li>
<li><b>Time-Limited Offers</b>: Purchase validated immediately, but items granted when player claims them</li>
<li><b>Login Rewards</b>: Player purchases a "30-Day Login Bonus" pack → items granted each day they log in</li>
<li><b>Failed Grants</b>: Purchase validated successfully, but item grant fails (network issue, database error) → retry later</li>
</ol>
<h2 class="doxsection"><a class="anchor" id="iap_separation_example"></a>
Example: Monthly Login Package</h2>
<p>A player purchases a "Monthly Gems Package" for $9.99 that grants 100 gems every day for 30 days:</p>
<div class="fragment"><div class="line"><span class="comment">// Day 1: Player completes purchase</span></div>
<div class="line"><span class="keywordtype">void</span> OnMonthlyPackagePurchased()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Report the monetary transaction ONCE</span></div>
<div class="line">    <a class="code hl_class" href="classKeewanoSDK.html">KeewanoSDK</a>.<a class="code hl_function" href="classKeewanoSDK.html#a865cb9d89581de571b8e52f113661cec">ReportInAppPurchase</a>(<span class="stringliteral">&quot;com.mygame.monthly_gems&quot;</span>, 999);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Grant first day&#39;s gems</span></div>
<div class="line">    <a class="code hl_namespace" href="namespaceKeewano.html">Keewano</a>.<a class="code hl_struct" href="structKeewano_1_1Item.html">Item</a>[] items = { <span class="keyword">new</span> <a class="code hl_namespace" href="namespaceKeewano.html">Keewano</a>.<a class="code hl_struct" href="structKeewano_1_1Item.html">Item</a>(<span class="stringliteral">&quot;Gems&quot;</span>, 100) };</div>
<div class="line">    <a class="code hl_class" href="classKeewanoSDK.html">KeewanoSDK</a>.<a class="code hl_function" href="classKeewanoSDK.html#a3ead93092535e6bf2eed29f7688c9632">ReportInAppPurchaseItemsGranted</a>(<span class="stringliteral">&quot;com.mygame.monthly_gems&quot;</span>, items);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Days 2-30: Player logs in each day</span></div>
<div class="line"><span class="keywordtype">void</span> OnDailyLogin()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (PlayerHasActiveMonthlyPackage())</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Grant daily gems (NO ReportInAppPurchase - already reported on Day 1)</span></div>
<div class="line">        <a class="code hl_namespace" href="namespaceKeewano.html">Keewano</a>.<a class="code hl_struct" href="structKeewano_1_1Item.html">Item</a>[] items = { <span class="keyword">new</span> <a class="code hl_namespace" href="namespaceKeewano.html">Keewano</a>.<a class="code hl_struct" href="structKeewano_1_1Item.html">Item</a>(<span class="stringliteral">&quot;Gems&quot;</span>, 100) };</div>
<div class="line">        <a class="code hl_class" href="classKeewanoSDK.html">KeewanoSDK</a>.<a class="code hl_function" href="classKeewanoSDK.html#a3ead93092535e6bf2eed29f7688c9632">ReportInAppPurchaseItemsGranted</a>(<span class="stringliteral">&quot;com.mygame.monthly_gems&quot;</span>, items);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="iap_flow"></a>
The Complete Purchase Flow</h1>
<p>Here's the recommended flow for handling in-app purchases:</p>
<h2 class="doxsection"><a class="anchor" id="iap_flow_diagram"></a>
Flow Diagram</h2>
<p> 
<pre class="mermaid">
sequenceDiagram
    actor Player
    participant Game
    participant Store as App Store
    participant Server as Your Server
    participant API as Apple/Google API
    participant SDK as KeewanoSDK

    Player->>Game: 1. Click "Buy" button
    activate Game

    rect rgb(200, 230, 201)
    note right of Game: Keewano Auto-Tracking
    Game->>SDK: 2. (Automatic) ReportButtonClick()
    end

    Game->>Store: 3. Initiate purchase
    deactivate Game
    activate Store
    Store->>Store: 4. Process payment
    Store->>Game: 5. Purchase receipt
    deactivate Store

    rect rgb(255, 243, 224)
    note right of Game: Server Validation Phase
    activate Game
    Game->>Server: 6. Validate receipt
    activate Server
    Server->>API: 7. Verify receipt
    activate API
    API-->>Server: 8. Valid confirmation
    deactivate API
    Server->>Server: 9. Grant items to player
    Server-->>Game: 10. Confirm grant
    deactivate Server
    end

    activate Store
    Game->>Store: 11. Finalize/acknowledge purchase
    Store-->>Game: 12. Purchase complete
    deactivate Store

    rect rgb(200, 230, 201)
    note right of Game: Keewano Reporting Phase
    Game->>SDK: 13. ReportInAppPurchase()
    Game->>SDK: 14. ReportInAppPurchaseItemsGranted()
    deactivate Game
    end
</pre>
</p>
<h1 class="doxsection"><a class="anchor" id="iap_scenarios"></a>
Common Scenarios</h1>
<h2 class="doxsection"><a class="anchor" id="iap_scenario_immediate"></a>
Scenario 1: Immediate Grant (Synchronous)</h2>
<p>The most common case where items are granted immediately after validation.</p>
<div class="fragment"><div class="line"><span class="comment">// Called by your server validation callback</span></div>
<div class="line"><span class="keywordtype">void</span> OnPurchaseValidated(<span class="keywordtype">string</span> productId, uint priceUsdCents, <a class="code hl_namespace" href="namespaceKeewano.html">Keewano</a>.<a class="code hl_struct" href="structKeewano_1_1Item.html">Item</a>[] grantedItems)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// 1. Report the monetary transaction</span></div>
<div class="line">    <a class="code hl_class" href="classKeewanoSDK.html">KeewanoSDK</a>.<a class="code hl_function" href="classKeewanoSDK.html#a865cb9d89581de571b8e52f113661cec">ReportInAppPurchase</a>(productId, priceUsdCents);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// 2. Report the items granted</span></div>
<div class="line">    <a class="code hl_class" href="classKeewanoSDK.html">KeewanoSDK</a>.<a class="code hl_function" href="classKeewanoSDK.html#a3ead93092535e6bf2eed29f7688c9632">ReportInAppPurchaseItemsGranted</a>(productId, grantedItems);</div>
<div class="line">}</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="iap_scenario_delayed"></a>
Scenario 2: Delayed Grant (Asynchronous)</h2>
<p>Purchase is validated first, items are granted later.</p>
<div class="fragment"><div class="line"><span class="comment">// Step 1: Server validates the purchase</span></div>
<div class="line"><span class="keywordtype">void</span> OnPurchaseValidated(<span class="keywordtype">string</span> productId, uint priceUsdCents)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Report the monetary transaction immediately</span></div>
<div class="line">    <a class="code hl_class" href="classKeewanoSDK.html">KeewanoSDK</a>.<a class="code hl_function" href="classKeewanoSDK.html#a865cb9d89581de571b8e52f113661cec">ReportInAppPurchase</a>(productId, priceUsdCents);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Server will grant items asynchronously...</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Step 2: Later, when server grants the items</span></div>
<div class="line"><span class="keywordtype">void</span> OnItemsGrantedFromPurchase(<span class="keywordtype">string</span> productId, <a class="code hl_namespace" href="namespaceKeewano.html">Keewano</a>.<a class="code hl_struct" href="structKeewano_1_1Item.html">Item</a>[] grantedItems)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Report the items that were granted</span></div>
<div class="line">    <a class="code hl_class" href="classKeewanoSDK.html">KeewanoSDK</a>.<a class="code hl_function" href="classKeewanoSDK.html#a3ead93092535e6bf2eed29f7688c9632">ReportInAppPurchaseItemsGranted</a>(productId, grantedItems);</div>
<div class="line">}</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="iap_scenario_monthly"></a>
Scenario 3: Monthly/Daily Packages</h2>
<p>Player purchases once, receives items over time.</p>
<div class="fragment"><div class="line"><span class="comment">// Player purchases &quot;30-Day VIP Pass&quot; for $14.99</span></div>
<div class="line"><span class="keywordtype">void</span> OnVIPPassPurchased()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Report purchase ONCE</span></div>
<div class="line">    <a class="code hl_class" href="classKeewanoSDK.html">KeewanoSDK</a>.<a class="code hl_function" href="classKeewanoSDK.html#a865cb9d89581de571b8e52f113661cec">ReportInAppPurchase</a>(<span class="stringliteral">&quot;com.mygame.vip_pass_30days&quot;</span>, 1499);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Grant Day 1 rewards</span></div>
<div class="line">    <a class="code hl_namespace" href="namespaceKeewano.html">Keewano</a>.<a class="code hl_struct" href="structKeewano_1_1Item.html">Item</a>[] day1Rewards = {</div>
<div class="line">        <span class="keyword">new</span> <a class="code hl_namespace" href="namespaceKeewano.html">Keewano</a>.<a class="code hl_struct" href="structKeewano_1_1Item.html">Item</a>(<span class="stringliteral">&quot;VIP_Status&quot;</span>, 30), <span class="comment">// 30 days of VIP</span></div>
<div class="line">        <span class="keyword">new</span> <a class="code hl_namespace" href="namespaceKeewano.html">Keewano</a>.<a class="code hl_struct" href="structKeewano_1_1Item.html">Item</a>(<span class="stringliteral">&quot;Daily_Gems&quot;</span>, 200)</div>
<div class="line">    };</div>
<div class="line">    <a class="code hl_class" href="classKeewanoSDK.html">KeewanoSDK</a>.<a class="code hl_function" href="classKeewanoSDK.html#a3ead93092535e6bf2eed29f7688c9632">ReportInAppPurchaseItemsGranted</a>(<span class="stringliteral">&quot;com.mygame.vip_pass_30days&quot;</span>, day1Rewards);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Each subsequent day (2-30)</span></div>
<div class="line"><span class="keywordtype">void</span> OnDailyLogin()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (PlayerHasActiveVIPPass())</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Grant daily rewards (NO ReportInAppPurchase call)</span></div>
<div class="line">        <a class="code hl_namespace" href="namespaceKeewano.html">Keewano</a>.<a class="code hl_struct" href="structKeewano_1_1Item.html">Item</a>[] dailyRewards = {</div>
<div class="line">            <span class="keyword">new</span> <a class="code hl_namespace" href="namespaceKeewano.html">Keewano</a>.<a class="code hl_struct" href="structKeewano_1_1Item.html">Item</a>(<span class="stringliteral">&quot;Daily_Gems&quot;</span>, 200)</div>
<div class="line">        };</div>
<div class="line">        <a class="code hl_class" href="classKeewanoSDK.html">KeewanoSDK</a>.<a class="code hl_function" href="classKeewanoSDK.html#a3ead93092535e6bf2eed29f7688c9632">ReportInAppPurchaseItemsGranted</a>(<span class="stringliteral">&quot;com.mygame.vip_pass_30days&quot;</span>, dailyRewards);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="iap_scenario_bundle"></a>
Scenario 4: Bundle with Multiple Items</h2>
<p>When a purchase grants multiple different items.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> OnStarterPackPurchased()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">string</span> productId = <span class="stringliteral">&quot;com.mygame.starter_pack&quot;</span>;</div>
<div class="line">    uint price = 999; <span class="comment">// $9.99</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Bundle contains multiple items</span></div>
<div class="line">    <a class="code hl_namespace" href="namespaceKeewano.html">Keewano</a>.<a class="code hl_struct" href="structKeewano_1_1Item.html">Item</a>[] bundleItems = {</div>
<div class="line">        <span class="keyword">new</span> <a class="code hl_namespace" href="namespaceKeewano.html">Keewano</a>.<a class="code hl_struct" href="structKeewano_1_1Item.html">Item</a>(<span class="stringliteral">&quot;Crystals&quot;</span>, 1000),</div>
<div class="line">        <span class="keyword">new</span> <a class="code hl_namespace" href="namespaceKeewano.html">Keewano</a>.<a class="code hl_struct" href="structKeewano_1_1Item.html">Item</a>(<span class="stringliteral">&quot;Gold_Coins&quot;</span>, 5000),</div>
<div class="line">        <span class="keyword">new</span> <a class="code hl_namespace" href="namespaceKeewano.html">Keewano</a>.<a class="code hl_struct" href="structKeewano_1_1Item.html">Item</a>(<span class="stringliteral">&quot;Epic_Sword&quot;</span>),</div>
<div class="line">        <span class="keyword">new</span> <a class="code hl_namespace" href="namespaceKeewano.html">Keewano</a>.<a class="code hl_struct" href="structKeewano_1_1Item.html">Item</a>(<span class="stringliteral">&quot;Health_Potion&quot;</span>, 10)</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classKeewanoSDK.html">KeewanoSDK</a>.<a class="code hl_function" href="classKeewanoSDK.html#a865cb9d89581de571b8e52f113661cec">ReportInAppPurchase</a>(productId, price);</div>
<div class="line">    <a class="code hl_class" href="classKeewanoSDK.html">KeewanoSDK</a>.<a class="code hl_function" href="classKeewanoSDK.html#a3ead93092535e6bf2eed29f7688c9632">ReportInAppPurchaseItemsGranted</a>(productId, bundleItems);</div>
<div class="line">}</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="iap_scenario_failed"></a>
Scenario 5: Purchase Validated but Grant Fails</h2>
<p>If the purchase is valid but item grant fails temporarily.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> OnPurchaseValidated(<span class="keywordtype">string</span> productId, uint priceUsdCents)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Report the monetary transaction (purchase was valid)</span></div>
<div class="line">    <a class="code hl_class" href="classKeewanoSDK.html">KeewanoSDK</a>.<a class="code hl_function" href="classKeewanoSDK.html#a865cb9d89581de571b8e52f113661cec">ReportInAppPurchase</a>(productId, priceUsdCents);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Attempt to grant items</span></div>
<div class="line">    <span class="keywordtype">bool</span> success = TryGrantItemsToPlayerAccount(productId);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (success)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_namespace" href="namespaceKeewano.html">Keewano</a>.<a class="code hl_struct" href="structKeewano_1_1Item.html">Item</a>[] items = GetItemsForProduct(productId);</div>
<div class="line">        <a class="code hl_class" href="classKeewanoSDK.html">KeewanoSDK</a>.<a class="code hl_function" href="classKeewanoSDK.html#a3ead93092535e6bf2eed29f7688c9632">ReportInAppPurchaseItemsGranted</a>(productId, items);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Log error - player paid but didn&#39;t receive items yet</span></div>
<div class="line">        <a class="code hl_class" href="classKeewanoSDK.html">KeewanoSDK</a>.<a class="code hl_function" href="classKeewanoSDK.html#a263fa179fc50f8ff84598bb34b99978d">LogError</a>($<span class="stringliteral">&quot;Failed to grant items for purchase: {productId}&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Implement retry logic</span></div>
<div class="line">        <span class="comment">// Call ReportInAppPurchaseItemsGranted later when items are successfully granted</span></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclassKeewanoSDK_html_a263fa179fc50f8ff84598bb34b99978d"><div class="ttname"><a href="classKeewanoSDK.html#a263fa179fc50f8ff84598bb34b99978d">KeewanoSDK.LogError</a></div><div class="ttdeci">static void LogError(string message)</div><div class="ttdoc">Reports a technical issue encountered during gameplay.</div><div class="ttdef"><b>Definition</b> KeewanoSDK.cs:525</div></div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="iap_best_practices"></a>
Best Practices</h1>
<h2 class="doxsection"><a class="anchor" id="iap_validation_critical"></a>
Server Validation is Critical</h2>
<p>❌ <b>NEVER do this:</b> </p><div class="fragment"><div class="line"><span class="comment">// BAD: Reporting immediately on store callback without validation</span></div>
<div class="line"><span class="keywordtype">void</span> OnAppStoreCallback(Purchase purchase)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// This is vulnerable to fraud!</span></div>
<div class="line">    <a class="code hl_class" href="classKeewanoSDK.html">KeewanoSDK</a>.<a class="code hl_function" href="classKeewanoSDK.html#a865cb9d89581de571b8e52f113661cec">ReportInAppPurchase</a>(purchase.productId, purchase.price);</div>
<div class="line">}</div>
</div><!-- fragment --><p>✅ <b>ALWAYS do this:</b> </p><div class="fragment"><div class="line"><span class="comment">// GOOD: Only report after server validation</span></div>
<div class="line"><span class="keywordtype">void</span> OnAppStoreCallback(Purchase purchase)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Send to your server for validation first</span></div>
<div class="line">    YourServerAPI.ValidatePurchase(purchase.receipt, OnValidationComplete);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> OnValidationComplete(ValidationResult result)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (result.isValid)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Now it&#39;s safe to report</span></div>
<div class="line">        <a class="code hl_class" href="classKeewanoSDK.html">KeewanoSDK</a>.<a class="code hl_function" href="classKeewanoSDK.html#a865cb9d89581de571b8e52f113661cec">ReportInAppPurchase</a>(result.productId, result.priceUsdCents);</div>
<div class="line">        <a class="code hl_class" href="classKeewanoSDK.html">KeewanoSDK</a>.<a class="code hl_function" href="classKeewanoSDK.html#a3ead93092535e6bf2eed29f7688c9632">ReportInAppPurchaseItemsGranted</a>(result.productId, result.items);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Server validation implementation is your responsibility. You must integrate with Apple's App Store Server API or Google Play Developer API to verify purchase receipts. This documentation shows when to call the Keewano SDK methods, not how to implement server validation.</dd></dl>
<h2 class="doxsection"><a class="anchor" id="iap_product_ids"></a>
Use Consistent Product IDs</h2>
<p>Use the same product ID for both methods: </p><div class="fragment"><div class="line"><span class="keywordtype">string</span> productId = <span class="stringliteral">&quot;com.mygame.crystals_500&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="classKeewanoSDK.html">KeewanoSDK</a>.<a class="code hl_function" href="classKeewanoSDK.html#a865cb9d89581de571b8e52f113661cec">ReportInAppPurchase</a>(productId, 499);</div>
<div class="line"><a class="code hl_class" href="classKeewanoSDK.html">KeewanoSDK</a>.<a class="code hl_function" href="classKeewanoSDK.html#a3ead93092535e6bf2eed29f7688c9632">ReportInAppPurchaseItemsGranted</a>(productId, items); <span class="comment">// Same productId</span></div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="iap_only_granted_items"></a>
Only Report Actually Granted Items</h2>
<p>Only call <span class="tt">ReportInAppPurchaseItemsGranted()</span> when items are successfully added to the player's account:</p>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> itemsGranted = AddItemsToPlayerInventory(items);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (itemsGranted)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Only report if grant succeeded</span></div>
<div class="line">    <a class="code hl_class" href="classKeewanoSDK.html">KeewanoSDK</a>.<a class="code hl_function" href="classKeewanoSDK.html#a3ead93092535e6bf2eed29f7688c9632">ReportInAppPurchaseItemsGranted</a>(productId, items);</div>
<div class="line">}</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="iap_price_usd"></a>
Prices Must Be in USD Cents</h2>
<p>Always convert prices to USD cents, regardless of the player's local currency:</p>
<div class="fragment"><div class="line"><span class="comment">// If local price is €4.49, convert to USD first (you must implement this conversion)</span></div>
<div class="line">uint priceUsdCents = ConvertToUsdCents(localPrice, localCurrency);</div>
<div class="line"><a class="code hl_class" href="classKeewanoSDK.html">KeewanoSDK</a>.<a class="code hl_function" href="classKeewanoSDK.html#a865cb9d89581de571b8e52f113661cec">ReportInAppPurchase</a>(productId, priceUsdCents);</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="iap_report_once"></a>
Report Purchase Once Only</h2>
<p>For packages where items are granted multiple times, only call <span class="tt">ReportInAppPurchase()</span> once when the purchase is made:</p>
<div class="fragment"><div class="line"><span class="comment">// DAY 1: Purchase completed</span></div>
<div class="line"><a class="code hl_class" href="classKeewanoSDK.html">KeewanoSDK</a>.<a class="code hl_function" href="classKeewanoSDK.html#a865cb9d89581de571b8e52f113661cec">ReportInAppPurchase</a>(<span class="stringliteral">&quot;monthly_pack&quot;</span>, 999);        <span class="comment">// ✅ Call ONCE</span></div>
<div class="line"><a class="code hl_class" href="classKeewanoSDK.html">KeewanoSDK</a>.<a class="code hl_function" href="classKeewanoSDK.html#a3ead93092535e6bf2eed29f7688c9632">ReportInAppPurchaseItemsGranted</a>(<span class="stringliteral">&quot;monthly_pack&quot;</span>, day1Items);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// DAY 2-30: Daily rewards</span></div>
<div class="line"><span class="comment">// ❌ Do NOT call ReportInAppPurchase again</span></div>
<div class="line"><a class="code hl_class" href="classKeewanoSDK.html">KeewanoSDK</a>.<a class="code hl_function" href="classKeewanoSDK.html#a3ead93092535e6bf2eed29f7688c9632">ReportInAppPurchaseItemsGranted</a>(<span class="stringliteral">&quot;monthly_pack&quot;</span>, dailyItems); <span class="comment">// ✅ Call each day</span></div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="iap_string_limits"></a>
String Parameter Limits</h1>
<p>Product IDs and item names are limited to 255 characters and will be trimmed if longer. Empty or null strings will skip the event.</p>
<h1 class="doxsection"><a class="anchor" id="iap_see_also"></a>
See Also</h1>
<ul>
<li><a class="el" href="ItemExchange.html">In-Game Balance</a> - For tracking virtual-to-virtual item exchanges</li>
<li><a class="el" href="classKeewanoSDK.html#a865cb9d89581de571b8e52f113661cec" title="Reports an in-app purchase event.">KeewanoSDK.ReportInAppPurchase</a> - API reference</li>
<li><a class="el" href="classKeewanoSDK.html#a3ead93092535e6bf2eed29f7688c9632" title="Reports items granted from an in-app purchase.">KeewanoSDK.ReportInAppPurchaseItemsGranted</a> - API reference</li>
<li><a class="el" href="classKeewanoSDK.html#a03af6ed00403dce0cad7dbcc44f88463" title="Reports an item exchange event using item arrays.">KeewanoSDK.ReportItemsExchange</a> - API reference for virtual economy tracking </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
